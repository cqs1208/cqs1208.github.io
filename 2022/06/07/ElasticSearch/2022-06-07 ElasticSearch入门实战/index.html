<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="elasticSearch">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch入门实战">
<meta property="og:url" content="http://example.com/2022/06/07/ElasticSearch/2022-06-07%20ElasticSearch%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="elasticSearch">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/ElasticSearch/Es_base01.png">
<meta property="og:image" content="http://example.com/images/ElasticSearch/Es_base02.png">
<meta property="og:image" content="http://example.com/images/ElasticSearch/Es_base03.png">
<meta property="og:image" content="http://example.com/images/ElasticSearch/Es_base04.png">
<meta property="article:published_time" content="2022-06-07T05:58:22.875Z">
<meta property="article:modified_time" content="2022-06-09T05:57:55.049Z">
<meta property="article:author" content="QingSong">
<meta property="article:tag" content="elasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/ElasticSearch/Es_base01.png">

<link rel="canonical" href="http://example.com/2022/06/07/ElasticSearch/2022-06-07%20ElasticSearch%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>ElasticSearch入门实战 | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">点滴积累 豁达处之</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/07/ElasticSearch/2022-06-07%20ElasticSearch%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.png">
      <meta itemprop="name" content="QingSong">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ElasticSearch入门实战
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-06-07 13:58:22" itemprop="dateCreated datePublished" datetime="2022-06-07T13:58:22+08:00">2022-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-09 13:57:55" itemprop="dateModified" datetime="2022-06-09T13:57:55+08:00">2022-06-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticSearch/" itemprop="url" rel="index"><span itemprop="name">elasticSearch</span></a>
                </span>
            </span>

          
            <div class="post-description">elasticSearch</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ElasticSearch入门实战</p>
<a id="more"></a> 

<h2 id="ElasticSearch简介"><a href="#ElasticSearch简介" class="headerlink" title="ElasticSearch简介"></a><strong>ElasticSearch简介</strong></h2><h3 id="ElasticSearch（简称ES）"><a href="#ElasticSearch（简称ES）" class="headerlink" title="ElasticSearch（简称ES）"></a><strong>ElasticSearch（简称ES）</strong></h3><p>Elasticsearch是用Java开发并且是当前最流行的开源的企业级搜索引擎。</p>
<p>能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<p>客户端支持Java、.NET（C#）、PHP、Python、Ruby等多种语言。</p>
<p><strong>官方网站:</strong> <strong><a target="_blank" rel="noopener" href="https://www.elastic.co/">https://www.elastic.co/</a></strong></p>
<p><strong>下载地址：</strong><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/start">https://www.elastic.co/cn/start</a></p>
<h3 id="ElasticSearch与Lucene的关系"><a href="#ElasticSearch与Lucene的关系" class="headerlink" title="ElasticSearch与Lucene的关系"></a><strong>ElasticSearch与Lucene的关系</strong></h3><p>Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库（框架）</p>
<p>但是想要使用Lucene，必须使用Java来作为开发语言并将其直接集成到你的应用中，并且Lucene的配置及使用非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。</p>
<p>Lucene缺点：</p>
<p>   1）只能在Java项目中使用,并且要以jar包的方式直接集成项目中.</p>
<p>   2）使用非常复杂-创建索引和搜索索引代码繁杂</p>
<p>   3）不支持集群环境-索引数据不同步（不支持大型项目）   </p>
<p>   4）索引数据如果太多就不行，索引库和应用所在同一个服务器,共同占用硬盘.共用空间少.</p>
<p>上述Lucene框架中的缺点,ES全部都能解决.</p>
<h2 id="Lucene全文检索框架"><a href="#Lucene全文检索框架" class="headerlink" title="Lucene全文检索框架"></a><strong>Lucene全文检索框架</strong></h2><h3 id="什么是全文检索"><a href="#什么是全文检索" class="headerlink" title="什么是全文检索"></a>什么是全文检索</h3><p>全文检索是指：</p>
<ul>
<li>通过一个程序扫描文本中的每一个单词，针对单词建立索引，并保存该单词在文本中的位置、以及出现的次数</li>
<li>用户查询时，通过之前建立好的索引来查询，将索引中单词对应的文本位置、出现的次数返回给用户，因为有了具体文本的位置，所以就可以将具体内容读取出来了</li>
</ul>
<h3 id="分词原理之倒排索引"><a href="#分词原理之倒排索引" class="headerlink" title="分词原理之倒排索引"></a><strong>分词原理之倒排索引</strong></h3><p><img src="/images/ElasticSearch/Es_base01.png" alt="Es_base01"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello   what  world    &#x3D;&#x3D;&#x3D;&#x3D;&gt;   hello</span><br><span class="line">                                what</span><br><span class="line">                                world</span><br></pre></td></tr></table></figure>

<h2 id="Elasticsearch中的核心概念"><a href="#Elasticsearch中的核心概念" class="headerlink" title="Elasticsearch中的核心概念"></a><strong>Elasticsearch中的核心概念</strong></h2><p><strong>索引 index</strong></p>
<p>一个索引就是一个拥有几分相似特征的文档的集合。比如说，可以有一个客户数据的索引，另一个产品目录的索引，还有一个订单数据的索引</p>
<p> 一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字</p>
<p><strong>映射 mapping</strong></p>
<p> <strong>ElasticSearch中的映射（Mapping）用来定义一个文档</strong></p>
<p> mapping是处理数据的方式和规则方面做一些限制，如某个字段的数据类型、默认值、分词器、是否被索引等等，这些都是映射里面可以设置的</p>
<p><strong>字段Field</strong></p>
<p>相当于是数据表的字段|列</p>
<p><strong>字段类型 Type</strong></p>
<p>每一个字段都应该有一个对应的类型，例如：Text、Keyword、Byte等</p>
<p><strong>文档 document</strong></p>
<p>一个文档是一个可被索引的基础信息单元，类似一条记录。文档以JSON（Javascript Object Notation）格式来表示；</p>
<p><strong>集群 cluster</strong></p>
<p>一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能</p>
<p><strong>节点 node</strong></p>
<p>一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能</p>
<p> 一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中</p>
<p>这意味着，如果在网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中</p>
<p> 在一个集群里，可以拥有任意多个节点。而且，如果当前网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。</p>
<h3 id="分片和副本-shards-amp-replicas"><a href="#分片和副本-shards-amp-replicas" class="headerlink" title="分片和副本 shards&amp;replicas"></a><strong>分片和副本 shards&amp;replicas</strong></h3><h4 id="分片"><a href="#分片" class="headerlink" title="分片"></a><strong>分片</strong></h4><ul>
<li><p>一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有10亿文档的索引占据1TB的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢</p>
</li>
<li><p>为了解决这个问题，Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片</p>
</li>
<li><p>当创建一个索引的时候，可以指定你想要的分片的数量</p>
</li>
<li><p>每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上</p>
</li>
<li><p>分片很重要，主要有两方面的原因</p>
</li>
</ul>
<p>​         允许水平分割/扩展你的内容容量</p>
<p>​         允许在分片之上进行分布式的、并行的操作，进而提高性能/吞吐量</p>
<ul>
<li>至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户来说，这些都是透明的</li>
</ul>
<h4 id="副本"><a href="#副本" class="headerlink" title="副本"></a><strong>副本</strong></h4><ul>
<li>在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点不知怎么的就处于离线状态，或者由于任何原因消失了，这种情况下，有一个故障转移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做副本分片，或者直接叫副本</li>
</ul>
<ul>
<li>副本之所以重要，有两个主要原因</li>
</ul>
<p>​             1)  在分片/节点失败的情况下，提供了高可用性。</p>
<p>​                   注意到复制分片从不与原/主要（original/primary）分片置于同一节点上是非常重要的</p>
<p>​             2)  扩展搜索量/吞吐量，因为搜索可以在所有的副本上并行运行</p>
<p>​                  每个索引可以被分成多个分片。一个索引有0个或者多个副本</p>
<p>​                  一旦设置了副本，每个索引就有了主分片和副本分片，分片和副本的数量可以在索引</p>
<p>​                 创建的时候指定</p>
<p>​                在索引创建之后，可以在任何时候动态地改变副本的数量，但是不能改变分片的数量</p>
<h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a><strong>分词器</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">&quot;analyzer&quot;:&quot;standard&quot;,</span><br><span class="line">&quot;text&quot;:&quot;我爱你中国&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">&quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">&quot;text&quot;: &quot;中华人民共和国&quot;</span><br><span class="line"> &#125;</span><br><span class="line">#ik_smart:会做最粗粒度的拆分</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">&quot;analyzer&quot;:&quot;ik_max_word&quot;,</span><br><span class="line">&quot;text&quot;:&quot;我爱你中国&quot;</span><br><span class="line">&#125;</span><br><span class="line">#ik_max_word:会将文本做最细粒度的拆分</span><br></pre></td></tr></table></figure>

<h3 id="指定IK分词器作为默认分词器"><a href="#指定IK分词器作为默认分词器" class="headerlink" title="指定IK分词器作为默认分词器"></a><strong>指定IK分词器作为默认分词器</strong></h3><p>ES的默认分词设置是standard，这个在中文分词时就比较尴尬了，会单字拆分，比如我搜索关键词“清华大学”，这时候会按“清”，“华”，“大”，“学”去分词，然后搜出来的都是些“清清的河水”，“中华儿女”，“地大物博”，“学而不思则罔”之类的莫名其妙的结果，这里我们就想把这个分词方式修改一下，于是呢，就想到了ik分词器，有两种ik_smart和ik_max_word。</p>
<p>ik_smart会将“清华大学”整个分为一个词，而ik_max_word会将“清华大学”分为“清华大学”，“清华”和“大学”，按需选其中之一就可以了。</p>
<p>修改默认分词方法(这里修改school_index索引的默认分词为：ik_max_word)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;school_index   # school_index:索引</span><br><span class="line">&#123;</span><br><span class="line">&quot;settings&quot; : &#123;</span><br><span class="line">&quot;index&quot; : &#123;</span><br><span class="line">&quot;analysis.analyzer.default.type&quot;: &quot;ik_max_word&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ES数据管理"><a href="#ES数据管理" class="headerlink" title="ES数据管理"></a><strong>ES数据管理</strong></h2><h3 id="ES数据管理概述"><a href="#ES数据管理概述" class="headerlink" title="ES数据管理概述"></a><strong>ES数据管理概述</strong></h3><p>ES是面向文档(document oriented)的，这意味着它可以存储整个对象或文档(document)。</p>
<p>然而它不仅仅是存储，还会索引(index)每个文档的内容使之可以被搜索。</p>
<p>在ES中，你可以对文档（而非成行成列的数据）进行索引、搜索、排序、过滤。</p>
<p>ES使用JSON作为文档序列化格式。</p>
<p>JSON现在已经被大多语言所支持，而且已经成为NoSQL领域的标准格式。</p>
<p>ES存储的一个员工文档的格式示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;email&quot;</span>: <span class="string">&quot;584614151@qq.com&quot;</span>,</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line"> <span class="string">&quot;age&quot;</span>: <span class="number">30</span>,</span><br><span class="line"> <span class="string">&quot;interests&quot;</span>: [ <span class="string">&quot;篮球&quot;</span>, <span class="string">&quot;健身&quot;</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a><strong>基本操作</strong></h3><ol>
<li>创建索引</li>
</ol>
<p>格式: PUT /索引名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">举例: PUT &#x2F;es_db</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查询索引</li>
</ol>
<p>格式: GET /索引名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">举例: GET &#x2F;es_db</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>删除索引</li>
</ol>
<p>格式: DELETE /索引名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">举例: DELETE &#x2F;es_db		 </span><br></pre></td></tr></table></figure>

<ol start="4">
<li>添加文档 </li>
</ol>
<p>格式: PUT /索引名称/类型/id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">举例: </span><br><span class="line">PUT &#x2F;es_db&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">&quot;sex&quot;: 1,</span><br><span class="line">&quot;age&quot;: 25,</span><br><span class="line">&quot;address&quot;: &quot;广州天河公园&quot;,</span><br><span class="line">&quot;remark&quot;: &quot;java developer&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>修改文档</li>
</ol>
<p>格式: PUT /索引名称/类型/id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;白起老师&quot;,</span><br><span class="line">&quot;sex&quot;: 1,</span><br><span class="line">&quot;age&quot;: 25,</span><br><span class="line">&quot;address&quot;: &quot;张家界森林公园&quot;,</span><br><span class="line">&quot;remark&quot;: &quot;php developer assistant&quot;				</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意:POST和PUT都能起到创建/更新的作用</p>
<p>1、需要注意的是==PUT==需要对一个具体的资源进行操作也就是要确定id才能进行==更新/创建，而==POST==是可以针对整个资源集合进行操作的，如果不写id就由ES生成一个唯一id进行==创建==新文档，如果填了id那就针对这个id的文档进行创建/更新</p>
<p>2、PUT只会将json数据都进行替换, POST只会更新相同字段的值</p>
<p>3、PUT与DELETE都是幂等性操作, 即不论操作多少次, 结果都一样</p>
<ol start="6">
<li>查询文档</li>
</ol>
<p>格式: GET /索引名称/类型/id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;1</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>删除文档</li>
</ol>
<p>格式: DELETE /索引名称/类型/id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">举例: DELETE &#x2F;es_db&#x2F;_doc&#x2F;1</span><br></pre></td></tr></table></figure>

<h3 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a><strong>查询操作</strong></h3><p>查询当前类型中的所有文档 _search </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">SQL:  select * from student</span><br></pre></td></tr></table></figure>

<p>条件查询, 如要查询age等于28岁的 _search?q=<em>:**</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?q&#x3D;*:***</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?q&#x3D;age:28</span><br><span class="line">SQL:  select * from student where age &#x3D; 28</span><br></pre></td></tr></table></figure>

<p>范围查询, 如要查询age在25至26岁之间的 _search?q=*<strong>[</strong> TO **]  注意: TO 必须为大写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?q&#x3D;***[25 TO 26]</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?q&#x3D;age[25 TO 26]</span><br><span class="line">SQL:  select * from student where age between 25 and 26</span><br></pre></td></tr></table></figure>

<p>根据多个ID进行批量查询 _mget</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_mget</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_mget </span><br><span class="line">&#123;</span><br><span class="line"> &quot;ids&quot;:[&quot;1&quot;,&quot;2&quot;]  </span><br><span class="line"> &#125;</span><br><span class="line">SQL:  select * from student where id in (1,2)	</span><br></pre></td></tr></table></figure>

<p>查询年龄小于等于28岁的 :&lt;=</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?q&#x3D;age:&lt;&#x3D;**</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?q&#x3D;age:&lt;&#x3D;28</span><br><span class="line">SQL:  select * from student where age &lt;&#x3D; 28</span><br></pre></td></tr></table></figure>

<p>查询年龄大于28前的 :&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?q&#x3D;age:&gt;**</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?q&#x3D;age:&gt;28</span><br><span class="line">SQL:  select * from student where age &gt; 28</span><br></pre></td></tr></table></figure>

<p>分页查询 from=<em>&amp;size=</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?q&#x3D;age[25 TO 26]&amp;from&#x3D;0&amp;size&#x3D;1</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?q&#x3D;age[25 TO 26]&amp;from&#x3D;0&amp;size&#x3D;1</span><br><span class="line">SQL:  select * from student where age between 25 and 26 limit 0, 1 </span><br></pre></td></tr></table></figure>

<p>对查询结果只输出某些字段 _source=字段,字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?_source&#x3D;字段,字段</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?_source&#x3D;name,age</span><br><span class="line">SQL:  select name,age from student</span><br></pre></td></tr></table></figure>

<p>对查询结果排序 sort=字段:desc/asc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">格式: GET &#x2F;索引名称&#x2F;类型&#x2F;_search?sort&#x3D;字段 desc</span><br><span class="line">举例: GET &#x2F;es_db&#x2F;_doc&#x2F;_search?sort&#x3D;age:desc</span><br><span class="line">SQL:  select * from student order by age desc</span><br></pre></td></tr></table></figure>

<h3 id="文档批量操作"><a href="#文档批量操作" class="headerlink" title="文档批量操作"></a>文档批量操作</h3><p>这里多个文档是指，批量操作多个文档，搜索查询文档将在之后的章节讲解</p>
<h4 id="批量获取文档数据"><a href="#批量获取文档数据" class="headerlink" title="批量获取文档数据"></a>批量获取文档数据</h4><p>批量获取文档数据是通过_mget的API来实现的</p>
<p>(1)在URL中不指定index和type</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求地址：_mget</p>
</li>
<li><p>功能说明 ： 可以通过ID批量获取不同index和type的数据</p>
</li>
<li><p>请求参数：</p>
</li>
<li><ul>
<li>docs : 文档数组参数</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>_index : 指定index</li>
<li>_type : 指定type</li>
<li>_id : 指定id</li>
<li>_source : 指定要查询的字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET _mget</span><br><span class="line">&#123;</span><br><span class="line">&quot;docs&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_index&quot;: &quot;es_db&quot;,</span><br><span class="line">&quot;_type&quot;: &quot;_doc&quot;,</span><br><span class="line">&quot;_id&quot;: 1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_index&quot;: &quot;es_db&quot;,</span><br><span class="line">&quot;_type&quot;: &quot;_doc&quot;,</span><br><span class="line">&quot;_id&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2)在URL中指定index</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求地址：//_mget</p>
</li>
<li><p>功能说明 ： 可以通过ID批量获取不同index和type的数据</p>
</li>
<li><p>请求参数：</p>
</li>
<li><ul>
<li>docs : 文档数组参数</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>_index : 指定index</li>
<li>_type : 指定type</li>
<li>_id : 指定id</li>
<li>_source : 指定要查询的字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;es_db&#x2F;_mget</span><br><span class="line">&#123;</span><br><span class="line">&quot;docs&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_type&quot;:&quot;_doc&quot;,</span><br><span class="line">&quot;_id&quot;: 3</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_type&quot;:&quot;_doc&quot;,</span><br><span class="line">&quot;_id&quot;: 4</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(3)在URL中指定index和type</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求地址：///_mget</p>
</li>
<li><p>功能说明 ： 可以通过ID批量获取不同index和type的数据</p>
</li>
<li><p>请求参数：</p>
</li>
<li><ul>
<li>docs : 文档数组参数</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>_index : 指定index</li>
<li>_type : 指定type</li>
<li>_id : 指定id</li>
<li>_source : 指定要查询的字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;es_db&#x2F;_doc&#x2F;_mget</span><br><span class="line">&#123;</span><br><span class="line">&quot;docs&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot;: 1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="批量操作文档数据"><a href="#批量操作文档数据" class="headerlink" title="批量操作文档数据"></a>批量操作文档数据</h4><p>批量对文档进行写操作是通过_bulk的API来实现的</p>
<ul>
<li><p>请求方式：POST</p>
</li>
<li><p>请求地址：_bulk</p>
</li>
<li><p>请求参数：通过_bulk操作文档，一般至少有两行参数(或偶数行参数)</p>
</li>
<li><ul>
<li>第一行参数为指定操作的类型及操作的对象(index,type和id)</li>
<li>第二行参数才是操作的数据</li>
</ul>
</li>
</ul>
<p>参数类似于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;actionName&quot;:&#123;&quot;_index&quot;:&quot;indexName&quot;, &quot;_type&quot;:&quot;typeName&quot;,&quot;_id&quot;:&quot;id&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;field1&quot;:&quot;value1&quot;, &quot;field2&quot;:&quot;value2&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>actionName：表示操作类型，主要有create,index,delete和update</li>
</ul>
<p>(1)批量创建文档create</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;白起老师1&quot;,&quot;content&quot;:&quot;白起老师666&quot;,&quot;tags&quot;:[&quot;java&quot;, &quot;面向对象&quot;],&quot;create_time&quot;:1554015482530&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:4&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;白起老师2&quot;,&quot;content&quot;:&quot;白起老师NB&quot;,&quot;tags&quot;:[&quot;java&quot;, &quot;面向对象&quot;],&quot;create_time&quot;:1554015482530&#125;</span><br></pre></td></tr></table></figure>

<p>(2)普通创建或全量替换index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;图灵徐庶老师(一)&quot;,&quot;content&quot;:&quot;图灵学院徐庶老师666&quot;,&quot;tags&quot;:[&quot;java&quot;, &quot;面向对象&quot;],&quot;create_time&quot;:1554015482530&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:4&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;图灵诸葛老师(二)&quot;,&quot;content&quot;:&quot;图灵学院诸葛老师NB&quot;,&quot;tags&quot;:[&quot;java&quot;, &quot;面向对象&quot;],&quot;create_time&quot;:1554015482530&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果原文档不存在，则是创建</li>
<li>如果原文档存在，则是替换(全量修改原文档)</li>
</ul>
<p>(3)批量删除delete</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:4&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>(4)批量修改update</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;ES大法必修内功&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;article&quot;, &quot;_type&quot;:&quot;_doc&quot;, &quot;_id&quot;:4&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;:&#123;&quot;create_time&quot;:1554018421008&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DSL语言高级查询"><a href="#DSL语言高级查询" class="headerlink" title="DSL语言高级查询"></a><strong>DSL语言高级查询</strong></h3><h4 id="Query-DSL概述"><a href="#Query-DSL概述" class="headerlink" title="Query DSL概述"></a><strong>Query DSL概述</strong></h4><p><strong>Domain Specific Language</strong></p>
<p><strong>领域专用语言</strong></p>
<p><strong>Elasticsearch provides a ful1 Query DSL based on JSON to define queries</strong></p>
<p><strong>Elasticsearch提供了基于JSON的DSL来定义查询。</strong></p>
<p><strong>DSL由叶子查询子句和复合查询子句两种子句组成。</strong></p>
<p><img src="/images/ElasticSearch/Es_base02.png" alt="Es_base02"></p>
<h4 id="无查询条件"><a href="#无查询条件" class="headerlink" title="无查询条件"></a><strong>无查询条件</strong></h4><p>无查询条件是查询所有，默认是查询所有的，或者使用match_all表示所有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;match_all&quot;:&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="有查询条件"><a href="#有查询条件" class="headerlink" title="有查询条件"></a><strong>有查询条件</strong></h4><h5 id="叶子条件查询-单字段查询条件"><a href="#叶子条件查询-单字段查询条件" class="headerlink" title="叶子条件查询(单字段查询条件)"></a><strong>叶子条件查询(单字段查询条件)</strong></h5><p><strong>模糊匹配</strong></p>
<p>模糊匹配主要是针对文本类型的字段，文本类型的字段会对内容进行分词，对查询时，也会对搜索条件进行分词，然后通过倒排索引查找到匹配的数据，模糊匹配主要通过match等参数来实现</p>
<ul>
<li>match : 通过match关键词模糊匹配条件内容</li>
<li>prefix : 前缀匹配</li>
<li>regexp : 通过正则表达式来匹配数据</li>
</ul>
<p><strong>match的复杂用法</strong></p>
<p>match条件还支持以下参数：</p>
<ul>
<li><p>query : 指定匹配的值</p>
</li>
<li><p>operator : 匹配条件类型</p>
</li>
<li><ul>
<li>and : 条件分词后都要匹配</li>
<li>or : 条件分词后有一个匹配即可(默认)</li>
</ul>
</li>
<li><p>minmum_should_match : 指定最小匹配的数量</p>
</li>
</ul>
<p><strong>精确匹配</strong></p>
<ul>
<li>term : 单个条件相等</li>
<li>terms : 单个字段属于某个值数组内的值</li>
<li>range : 字段属于某个范围内的值</li>
<li>exists : 某个字段的值是否存在</li>
<li>ids : 通过ID批量查询</li>
</ul>
<h5 id="组合条件查询-多条件查询"><a href="#组合条件查询-多条件查询" class="headerlink" title="组合条件查询(多条件查询)"></a><strong>组合条件查询(多条件查询)</strong></h5><p>组合条件查询是将叶子条件查询语句进行组合而形成的一个完整的查询条件</p>
<ul>
<li><p>bool : 各条件之间有and,or或not的关系</p>
</li>
<li><ul>
<li>must : 各个条件都必须满足，即各条件是and的关系</li>
<li>should : 各个条件有一个满足即可，即各条件是or的关系</li>
<li>must_not : 不满足所有条件，即各条件是not的关系</li>
<li>filter : 不计算相关度评分，它不计算_score即相关度评分，效率更高</li>
</ul>
</li>
<li><p>constant_score : 不计算相关度评分</p>
</li>
</ul>
<p><strong>must/filter/shoud/must_not</strong> 等的子条件是通过 <strong>term/terms/range/ids/exists/match</strong> 等叶子条件为参数的</p>
<p>注：以上参数，当只有一个搜索条件时，must等对应的是一个对象，当是多个条件时，对应的是一个数组</p>
<h5 id="连接查询-多文档合并查询"><a href="#连接查询-多文档合并查询" class="headerlink" title="连接查询(多文档合并查询)"></a><strong>连接查询(多文档合并查询)</strong></h5><ul>
<li>父子文档查询：parent/child</li>
<li>嵌套文档查询: nested</li>
</ul>
<h5 id="查询DSL（query-DSL）和过滤DSL（filter-DSL）"><a href="#查询DSL（query-DSL）和过滤DSL（filter-DSL）" class="headerlink" title="查询DSL（query DSL）和过滤DSL（filter DSL）"></a>查询DSL（query DSL）和过滤DSL（filter DSL）</h5><p>它们两个的区别如下图：</p>
<p><img src="/images/ElasticSearch/Es_base03.png" alt="Es_base03"></p>
<p><strong>query DSL</strong></p>
<p>在查询上下文中，查询会回答这个问题——“这个文档匹不匹配这个查询，它的相关度高么？”</p>
<p>如何验证匹配很好理解，如何计算相关度呢？ES中索引的数据都会存储一个_score分值，分值越高就代表越匹配。另外关于某个搜索的分值计算还是很复杂的，因此也需要一定的时间。</p>
<p><strong>filter DSL</strong></p>
<p>在过滤器上下文中，查询会回答这个问题——“这个文档匹不匹配？”答案很简单，是或者不是。它不会去计算任何分值，也不会关心返回的排序问题，因此效率会高一点。过滤上下文 是在使用filter参数时候的执行环境，比如在bool查询中使用must_not或者filter另外，经常使用过滤器，ES会自动的缓存过滤器的内容，这对于查询来说，会提高很多性能。一些过滤的情况：</p>
<h4 id="Query方式查询-案例"><a href="#Query方式查询-案例" class="headerlink" title="Query方式查询:案例"></a><strong>Query方式查询:案例</strong></h4><ul>
<li><p>根据名称精确查询姓名 term, term查询不会对字段进行分词查询，会采用精确匹配 </p>
<p>注意: 采用term精确查询, 查询字段映射类型属于为keyword.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line">&quot;term&quot;: &#123;</span><br><span class="line">&quot;name&quot;: &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL: select * from student where name &#x3D; &#39;admin&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据备注信息模糊查询 match, match会根据该字段的分词器，进行分词查询 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;from&quot;: 0,</span><br><span class="line">&quot;size&quot;: 2, </span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line">&quot;match&quot;: &#123;</span><br><span class="line">&quot;address&quot;: &quot;广州&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL: select * from user where address like &#39;%广州%&#39; limit 0, 2</span><br></pre></td></tr></table></figure>

<ul>
<li>多字段模糊匹配查询与精准查询 multi_match</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;multi_match&quot;:&#123;</span><br><span class="line">&quot;query&quot;:&quot;张三&quot;,</span><br><span class="line">&quot;fields&quot;:[&quot;address&quot;,&quot;name&quot;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL: select * from student  where name like &#39;%张三%&#39; or address like &#39;%张三%&#39; 	</span><br></pre></td></tr></table></figure>

<ul>
<li>未指定字段条件查询 query_string , 含 AND 与 OR 条件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;query_string&quot;:&#123;</span><br><span class="line">&quot;query&quot;:&quot;广州 OR 长沙&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>指定字段条件查询 query_string , 含 AND 与 OR 条件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;query_string&quot;:&#123;</span><br><span class="line">&quot;query&quot;:&quot;admin OR 长沙&quot;,</span><br><span class="line">&quot;fields&quot;:[&quot;name&quot;,&quot;address&quot;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>范围查询</li>
</ul>
<p>​     注：json请求字符串中部分字段的含义</p>
<p>​    range：范围关键字</p>
<p>​    gte 大于等于</p>
<p>​    lte  小于等于</p>
<p>​    gt 大于</p>
<p>​    lt 小于</p>
<p>​    now 当前时间    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot; : &#123;</span><br><span class="line">&quot;range&quot; : &#123;</span><br><span class="line">&quot;age&quot; : &#123;</span><br><span class="line">&quot;gte&quot;:25,</span><br><span class="line">&quot;lte&quot;:28</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL: select * from user where age between 25 and 28			</span><br></pre></td></tr></table></figure>

<ul>
<li>分页、输出字段、排序综合查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot; : &#123;</span><br><span class="line">&quot;range&quot; : &#123;</span><br><span class="line">&quot;age&quot; : &#123;</span><br><span class="line">&quot;gte&quot;:25,</span><br><span class="line">&quot;lte&quot;:28</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;from&quot;: 0,</span><br><span class="line">&quot;size&quot;: 2,</span><br><span class="line">&quot;_source&quot;: [&quot;name&quot;, &quot;age&quot;, &quot;book&quot;],</span><br><span class="line">&quot;sort&quot;: &#123;&quot;age&quot;:&quot;desc&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Filter过滤器方式查询"><a href="#Filter过滤器方式查询" class="headerlink" title="Filter过滤器方式查询"></a><strong>Filter过滤器方式查询</strong></h4><p><strong>Filter过滤器方式查询，它的查询不会计算相关性分值，也不会对结果进行排序, 因此效率会高一点，查询的结果可以被缓存。</strong></p>
<p>Filter Context 对数据进行过滤 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot; : &#123;</span><br><span class="line">&quot;bool&quot; : &#123;</span><br><span class="line">&quot;filter&quot; : &#123;</span><br><span class="line">&quot;term&quot;:&#123;</span><br><span class="line">&quot;age&quot;:25</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h4><p><strong>1. match</strong> </p>
<p>match：模糊匹配，需要指定字段名，但是输入会进行分词，比如”hello world”会进行拆分为hello和world，然后匹配，如果字段中包含hello或者world，或者都包含的结果都会被查询出来，也就是说match是一个部分匹配的模糊查询。查询条件相对来说比较宽松。</p>
<p><strong>2. term</strong> </p>
<p>term:  这种查询和match在有些时候是等价的，比如我们查询单个的词hello，那么会和match查询结果一样，但是如果查询”hello world”，结果就相差很大，因为这个输入不会进行分词，就是说查询的时候，是查询字段分词结果中是否有”hello world”的字样，而不是查询字段中包含”hello world”的字样。当保存数据”hello world”时，elasticsearch会对字段内容进行分词，”hello world”会被分成hello和world，不存在”hello world”，因此这里的查询结果会为空。这也是term查询和match的区别。</p>
<p><strong>3. match_phase</strong> </p>
<p>match_phase：会对输入做分词，但是需要结果中也包含所有的分词，而且顺序要求一样。以”hello world”为例，要求结果中必须包含hello和world，而且还要求他们是连着的，顺序也是固定的，hello that world不满足，world hello也不满足条件。</p>
<p><strong>4. query_string</strong> </p>
<p>query_string：和match类似，但是match需要指定字段名，query_string是在所有字段中搜索，范围更广泛。</p>
<h2 id="文档映射"><a href="#文档映射" class="headerlink" title="文档映射"></a><strong>文档映射</strong></h2><p>1.ES中映射可以分为动态映射和静态映射</p>
<p>动态映射： </p>
<p>在关系数据库中，需要事先创建数据库，然后在该数据库下创建数据表，并创建表字段、类型、长度、主键等，最后才能基于表插入数据。而Elasticsearch中不需要定义Mapping映射（即关系型数据库的表、字段等），在文档写入Elasticsearch时，会根据文档字段自动识别类型，这种机制称之为动态映射。</p>
<p>动态映射规则如下：</p>
<p><img src="/images/ElasticSearch/Es_base04.png" alt="Es_base04"></p>
<p>静态映射： </p>
<p> 静态映射是在Elasticsearch中也可以事先定义好映射，包含文档的各字段类型、分词器等，这种方式称之为静态映射。</p>
<h3 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a>动态映射</h3><p>删除原创建的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;es_db</span><br></pre></td></tr></table></figure>

<p> 创建索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db</span><br></pre></td></tr></table></figure>

<p>创建文档(ES根据数据类型, 会自动创建映射)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Jack&quot;,</span><br><span class="line">&quot;sex&quot;: 1,</span><br><span class="line">&quot;age&quot;: 25,</span><br><span class="line">&quot;book&quot;: &quot;java入门至精通&quot;,</span><br><span class="line">&quot;address&quot;: &quot;广州小蛮腰&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取文档映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;es_db&#x2F;_mapping					</span><br></pre></td></tr></table></figure>

<h3 id="静态映射"><a href="#静态映射" class="headerlink" title="静态映射"></a>静态映射</h3><p>删除原创建的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;es_db</span><br></pre></td></tr></table></figure>

<p>创建索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db</span><br></pre></td></tr></table></figure>

<p>设置文档映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db</span><br><span class="line">&#123;</span><br><span class="line">&quot;mappings&quot;:&#123;</span><br><span class="line">&quot;properties&quot;:&#123;</span><br><span class="line">&quot;name&quot;:&#123;&quot;type&quot;:&quot;keyword&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;sex&quot;:&#123;&quot;type&quot;:&quot;integer&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;age&quot;:&#123;&quot;type&quot;:&quot;integer&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;book&quot;:&#123;&quot;type&quot;:&quot;text&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;address&quot;:&#123;&quot;type&quot;:&quot;text&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据静态映射创建文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Jack&quot;,</span><br><span class="line">&quot;sex&quot;: 1,</span><br><span class="line">&quot;age&quot;: 25,</span><br><span class="line">&quot;book&quot;: &quot;elasticSearch入门至精通&quot;,</span><br><span class="line">&quot;address&quot;: &quot;广州车陂&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取文档映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;es_db&#x2F;_mapping</span><br></pre></td></tr></table></figure>

<h2 id="核心类型（Core-datatype）"><a href="#核心类型（Core-datatype）" class="headerlink" title="核心类型（Core datatype）"></a><strong>核心类型（Core datatype）</strong></h2><p>字符串：string，string类型包含 text 和 keyword。</p>
<p>text：该类型被用来索引长文本，在创建索引前会将这些文本进行分词，转化为词的组合，建立索引；允许es来检索这些词，text类型不能用来排序和聚合。</p>
<p>keyword：该类型不能分词，可以被用来检索过滤、排序和聚合，keyword类型不可用text进行分词模糊检索。</p>
<p>数值型：long、integer、short、byte、double、float</p>
<p>日期型：date</p>
<p>布尔型：boolean</p>
<h3 id="keyword-与-text-映射类型的区别"><a href="#keyword-与-text-映射类型的区别" class="headerlink" title="keyword 与 text 映射类型的区别"></a><strong>keyword 与 text 映射类型的区别</strong></h3><p>将 book 字段设置为 keyword 映射 （只能精准查询, 不能分词查询，能聚合、排序）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line">&quot;term&quot;: &#123;</span><br><span class="line">&quot;book&quot;: &quot;elasticSearch入门至精通&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 book 字段设置为 text 映射能模糊查询, 能分词查询，不能聚合、排序）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_db&#x2F;_doc&#x2F;_search</span><br><span class="line">&#123; </span><br><span class="line">&quot;query&quot;: &#123;</span><br><span class="line">&quot;match&quot;: &#123;</span><br><span class="line">&quot;book&quot;: &quot;elasticSearch入门至精通&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建静态映射时指定text类型的ik分词器"><a href="#创建静态映射时指定text类型的ik分词器" class="headerlink" title="创建静态映射时指定text类型的ik分词器"></a><strong>创建静态映射时指定text类型的ik分词器</strong></h3><p>1.设置ik分词器的文档映射</p>
<p>先删除之前的es_db</p>
<p>再创建新的es_db</p>
<p>定义ik_smart的映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;es_db</span><br><span class="line">&#123;</span><br><span class="line">&quot;mappings&quot;:&#123;</span><br><span class="line">&quot;properties&quot;:&#123;</span><br><span class="line">&quot;name&quot;:&#123;&quot;type&quot;:&quot;keyword&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;sex&quot;:&#123;&quot;type&quot;:&quot;integer&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;age&quot;:&#123;&quot;type&quot;:&quot;integer&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;,</span><br><span class="line">&quot;book&quot;:&#123;&quot;type&quot;:&quot;text&quot;,&quot;index&quot;:true,&quot;store&quot;:true,&quot;analyzer&quot;:&quot;ik_smart&quot;,&quot;search_analyzer&quot;:&quot;ik_smart&quot;&#125;,</span><br><span class="line">&quot;address&quot;:&#123;&quot;type&quot;:&quot;text&quot;,&quot;index&quot;:true,&quot;store&quot;:true&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对已存在的mapping映射进行修改"><a href="#对已存在的mapping映射进行修改" class="headerlink" title="对已存在的mapping映射进行修改"></a>对已存在的mapping映射进行修改</h3><p>具体方法</p>
<p>   1）如果要推倒现有的映射, 你得重新建立一个静态索引        </p>
<p>   2）然后把之前索引里的数据导入到新的索引里        </p>
<p>   3）删除原创建的索引        </p>
<p>   4）为新索引起个别名, 为原索引名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">&quot;source&quot;: &#123;</span><br><span class="line">&quot;index&quot;: &quot;db_index&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;dest&quot;: &#123;</span><br><span class="line">&quot;index&quot;: &quot;db_index_2&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE &#x2F;db_index</span><br><span class="line"></span><br><span class="line">PUT &#x2F;db_index_2&#x2F;_alias&#x2F;db_index</span><br></pre></td></tr></table></figure>

<p><strong>注意: 通过这几个步骤就实现了索引的平滑过渡,并且是零停机</strong></p>
<h2 id="Elasticsearch乐观并发控制"><a href="#Elasticsearch乐观并发控制" class="headerlink" title="Elasticsearch乐观并发控制"></a><strong>Elasticsearch乐观并发控制</strong></h2><p>ES新版本(7.x)不使用version进行并发版本控制  if_seq_no=版本值&amp;if_primary_term=文档位置 </p>
<p>_seq_no：文档版本号，作用同_version</p>
<p>_primary_term：文档所在位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;es_sc&#x2F;_search</span><br><span class="line"></span><br><span class="line">DELETE &#x2F;es_sc</span><br><span class="line"></span><br><span class="line">POST &#x2F;es_sc&#x2F;_doc&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;id&quot;: 1,</span><br><span class="line">&quot;name&quot;: &quot;chen&quot;,</span><br><span class="line">&quot;desc&quot;: &quot;miaoshu&quot;,</span><br><span class="line">&quot;create_date&quot;: &quot;2021-02-24&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;es_sc&#x2F;_update&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;doc&quot;: &#123;</span><br><span class="line">&quot;name&quot;: &quot;chen&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST &#x2F;es_sc&#x2F;_update&#x2F;1&#x2F;?if_seq_no&#x3D;1&amp;if_primary_term&#x3D;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;doc&quot;: &#123;</span><br><span class="line">&quot;name&quot;: &quot;chen&quot;</span><br><span class="line">&#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;es_sc&#x2F;_update&#x2F;1&#x2F;?if_seq_no&#x3D;1&amp;if_primary_term&#x3D;1</span><br><span class="line">&#123;</span><br><span class="line">&quot;doc&quot;: &#123;</span><br><span class="line">&quot;name&quot;: &quot;chen&quot;</span><br><span class="line">&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://note.youdao.com/ynoteshare/index.html?id=83ea7925e0a1ae40e037f682b98d9874&type=note&_time=1654581747065">参考链接</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/elasticSearch/" rel="tag"># elasticSearch</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/07/Kafka/2022-06-07%20kafka%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/" rel="prev" title="kafka性能优化实战">
      <i class="fa fa-chevron-left"></i> kafka性能优化实战
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/06/09/ElasticSearch/2022-06-09%20ElasticSearch%E5%88%86%E8%AF%8D%E5%8F%8A%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/" rel="next" title="ElasticSearch分词器及聚合操作">
      ElasticSearch分词器及聚合操作 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">ElasticSearch简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ElasticSearch%EF%BC%88%E7%AE%80%E7%A7%B0ES%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">ElasticSearch（简称ES）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ElasticSearch%E4%B8%8ELucene%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">1.2.</span> <span class="nav-text">ElasticSearch与Lucene的关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lucene%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E6%A1%86%E6%9E%B6"><span class="nav-number">2.</span> <span class="nav-text">Lucene全文检索框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="nav-number">2.1.</span> <span class="nav-text">什么是全文检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E8%AF%8D%E5%8E%9F%E7%90%86%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="nav-number">2.2.</span> <span class="nav-text">分词原理之倒排索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Elasticsearch%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">3.</span> <span class="nav-text">Elasticsearch中的核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%89%87%E5%92%8C%E5%89%AF%E6%9C%AC-shards-amp-replicas"><span class="nav-number">3.1.</span> <span class="nav-text">分片和副本 shards&amp;replicas</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%89%87"><span class="nav-number">3.1.1.</span> <span class="nav-text">分片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%AF%E6%9C%AC"><span class="nav-number">3.1.2.</span> <span class="nav-text">副本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">分词器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9AIK%E5%88%86%E8%AF%8D%E5%99%A8%E4%BD%9C%E4%B8%BA%E9%BB%98%E8%AE%A4%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">4.1.</span> <span class="nav-text">指定IK分词器作为默认分词器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86"><span class="nav-number">5.</span> <span class="nav-text">ES数据管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ES%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E6%A6%82%E8%BF%B0"><span class="nav-number">5.1.</span> <span class="nav-text">ES数据管理概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="nav-number">5.3.</span> <span class="nav-text">查询操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">5.4.</span> <span class="nav-text">文档批量操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.1.</span> <span class="nav-text">批量获取文档数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.2.</span> <span class="nav-text">批量操作文档数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DSL%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.5.</span> <span class="nav-text">DSL语言高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Query-DSL%E6%A6%82%E8%BF%B0"><span class="nav-number">5.5.1.</span> <span class="nav-text">Query DSL概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A0%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="nav-number">5.5.2.</span> <span class="nav-text">无查询条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="nav-number">5.5.3.</span> <span class="nav-text">有查询条件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%B6%E5%AD%90%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-%E5%8D%95%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="nav-number">5.5.3.1.</span> <span class="nav-text">叶子条件查询(单字段查询条件)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.5.3.2.</span> <span class="nav-text">组合条件查询(多条件查询)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2-%E5%A4%9A%E6%96%87%E6%A1%A3%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.5.3.3.</span> <span class="nav-text">连接查询(多文档合并查询)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2DSL%EF%BC%88query-DSL%EF%BC%89%E5%92%8C%E8%BF%87%E6%BB%A4DSL%EF%BC%88filter-DSL%EF%BC%89"><span class="nav-number">5.5.3.4.</span> <span class="nav-text">查询DSL（query DSL）和过滤DSL（filter DSL）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Query%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2-%E6%A1%88%E4%BE%8B"><span class="nav-number">5.5.4.</span> <span class="nav-text">Query方式查询:案例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Filter%E8%BF%87%E6%BB%A4%E5%99%A8%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.5.5.</span> <span class="nav-text">Filter过滤器方式查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.5.6.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%98%A0%E5%B0%84"><span class="nav-number">6.</span> <span class="nav-text">文档映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84"><span class="nav-number">6.1.</span> <span class="nav-text">动态映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%98%A0%E5%B0%84"><span class="nav-number">6.2.</span> <span class="nav-text">静态映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%9E%8B%EF%BC%88Core-datatype%EF%BC%89"><span class="nav-number">7.</span> <span class="nav-text">核心类型（Core datatype）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#keyword-%E4%B8%8E-text-%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">7.1.</span> <span class="nav-text">keyword 与 text 映射类型的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9D%99%E6%80%81%E6%98%A0%E5%B0%84%E6%97%B6%E6%8C%87%E5%AE%9Atext%E7%B1%BB%E5%9E%8B%E7%9A%84ik%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">7.2.</span> <span class="nav-text">创建静态映射时指定text类型的ik分词器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84mapping%E6%98%A0%E5%B0%84%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9"><span class="nav-number">7.3.</span> <span class="nav-text">对已存在的mapping映射进行修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Elasticsearch%E4%B9%90%E8%A7%82%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="nav-number">8.</span> <span class="nav-text">Elasticsearch乐观并发控制</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="QingSong"
      src="/images/avatar/avatar.png">
  <p class="site-author-name" itemprop="name">QingSong</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QingSong</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
